<!DOCTYPE HTML>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Sortir du Portail</title>
	<style>
		body {
			background-color: lightgrey;
		}
	</style>
</head>

<body>


	<script>
		//Creation d'un canvas en Javascript au lieu de HTML
		var canvas = document.createElement("canvas");
		var ctx = canvas.getContext("2d");
		var start = 0
		var GameTime = 30000
		canvas.width = window.innerWidth - 50;
		canvas.height = window.innerHeight - 50
		canvas.style.border = "10px white solid";
		canvas.style.backgroundImage = "url('school.jpg')";
		canvas.style.backgroundSize = "100% 100%"
		canvas.style.display = "block";
		canvas.style.margin = "auto"
		document.body.appendChild(canvas);
		var gravity = 0.5;

		//variables et objets du jeu
		var joueur = {
			x: 10,
			y: canvas.height / 2 - 50,
			w: 100,
			h: 100,
			color: "blue",
			speed: 5,
			velocityY: 0
		}

		var baseHeight = canvas.height - 150;

		var cible = {
			x: canvas.width / 2 +550,
			y: canvas.height /2 -200,
			w: 200,
			h: 200,
			color: "blue",
		}



		var keyDown = {}
		var ImgJoueur = new Image()
		ImgJoueur.src = "pixel-art-asian-songkran-character-png.png"


		//fonctions
		function drawJoueur() {
			ctx.fillStyle = joueur.color
			ctx.drawImage(ImgJoueur, joueur.x, joueur.y, joueur.w, joueur.h)
		}

		function drawCible() {
			ctx.fillStyle = joueur.color
			ctx.fillRect(cible.x, cible.y, cible.w, cible.h)
		}

		document.addEventListener("keydown", function (e) {
			keyDown[e.keyCode] = true
			console.log(keyDown)
			if (keyDown[e.keyCode] == true) {
				start = 1
			}
		})

		document.addEventListener("keyup", function (e) {
			delete keyDown[e.keyCode]
			console.log(keyDown)
		})

		function applyGravity() {
			joueur.velocityY += gravity;
			joueur.y += joueur.velocityY;
			if (joueur.y + joueur.h > baseHeight) { // Check against the base height instead of canvas height
				joueur.y = baseHeight - joueur.h;
				joueur.velocityY = 0;
			}
		}

		function clavier() {
			if (65 in keyDown && joueur.x > 0) {
				joueur.x -= joueur.speed;
			}
			if (68 in keyDown && joueur.x < canvas.width - joueur.w) {
				joueur.x += joueur.speed;
			}
			if (32 in keyDown && joueur.y + joueur.h >= baseHeight) { // Check against the base height instead of canvas height
				joueur.velocityY = -12;
			}
		}

		function collision(a, b) {
			if (a.x + a.w > b.x &&
				a.x < b.x + b.w &&
				a.y + a.h > b.y &&
				a.y < b.y + b.h
			) { return (true) }
		}

		function checkCollision() {
			if (collision(joueur, cible)) {
				joueur.x = 10
				joueur.y = canvas.height / 2 - 50
			}
		}


		//boucle principale du jeu

		function game() {
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			drawJoueur();
			drawCible();
			clavier();
			applyGravity();
			checkCollision();
			requestAnimationFrame(game);
		}
		game()

	</script>
</body>

</html>